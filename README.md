
# 캐슬 브레이커 (Castle Breaker)

"캐슬 브레이커"는 플레이어가 발사체를 사용하여 블록으로 만들어진 성을 무너뜨리고, 빛나는 황금 블록을 조준하는 3D 물리 기반 게임입니다. React, Three.js, Cannon-es, Tailwind CSS를 사용하여 제작되었으며, Gemini API를 활용한 AI 레벨 생성 기능도 포함하고 있습니다.

실행 주소 : https://dev-canvas-pi.vercel.app/

## 목차

- [주요 기술 스택](#주요-기술-스택)
- [핵심 기능](#핵심-기능)
- [프로젝트 구조](#프로젝트-구조)
- [설정 및 실행](#설정-및-실행)
  - [API 키 설정 (Gemini API)](#api-키-설정-gemini-api)
- [게임 방법](#게임-방법)
- [레벨 에디터 사용법](#레벨-에디터-사용법)
- [레벨 라이브러리 사용법](#레벨-라이브러리-사용법)
- [향후 개발 방향](#향후-개발-방향)
- [현지화](#현지화)

## 주요 기술 스택

*   **React:** 사용자 인터페이스 구축
*   **Three.js:** 3D 그래픽 렌더링
*   **Cannon-es:** 3D 물리 엔진
*   **Tailwind CSS:** UI 스타일링
*   **TypeScript:** 정적 타입 지원
*   **@google/genai (Gemini API):** AI 기반 레벨 생성을 위한 클라이언트 라이브러리

## 핵심 기능

*   **물리 기반 게임플레이:** 현실적인 블록 무너짐과 발사체 상호작용.
*   **다양한 발사체:**
    *   일반탄: 기본적인 만능 발사체
    *   중량탄: 무겁고 강력하여 직접 타격에 효과적
    *   폭발탄: 충돌 시 폭발하여 주변에 피해
    *   분열탄: 발사 후 여러 개의 작은 발사체로 분열
*   **점수 시스템:** 블록 파괴 및 황금 블록 명중 시 점수 획득.
*   **기본 제공 레벨:** 다양한 난이도의 사전 제작된 레벨 제공.
*   **레벨 에디터:**
    *   직관적인 3D 인터페이스에서 블록(큐브, 원기둥, 구, 직육면체 등 다양한 모양) 배치.
    *   블록 색상 및 모양 선택.
    *   승리 조건인 '황금 블록' 지정.
    *   생성한 커스텀 레벨을 로컬 라이브러리에 저장.
    *   개별 커스텀 레벨을 JSON 파일로 가져오기/내보내기.
*   **AI 레벨 생성 (Gemini API 연동):**
    *   텍스트 프롬프트를 기반으로 Gemini API가 새로운 레벨 구조를 동적으로 생성.
    *   생성된 레벨은 에디터에서 바로 확인 및 수정 가능.
    *   (Gemini API 키 필요)
*   **레벨 라이브러리:**
    *   저장된 커스텀 레벨 목록 관리 (검색 기능 포함).
    *   선택한 커스텀 레벨 즉시 플레이.
    *   선택한 커스텀 레벨을 에디터로 불러와 수정.
    *   개별 커스텀 레벨 삭제.
    *   전체 커스텀 레벨 라이브러리를 JSON 파일로 가져오기/내보내기.
*   **파워 게이지:** 발사체 발사 시 파워 조절 가능 (길게 누를수록 강력).
*   **반응형 UI:** 다양한 화면 크기 지원.

## 프로젝트 구조

```
├── public/
│   ├── index.html                # 메인 HTML 파일
│   └── domino_castle_library.json # 기본 커스텀 레벨 라이브러리 (예시)
├── src/
│   ├── App.tsx                   # 메인 애플리케이션 컴포넌트, 상태 관리
│   ├── index.tsx                 # React 애플리케이션 진입점
│   ├── components/
│   │   ├── GameCanvas.tsx        # Three.js & Cannon-es 게임 렌더링 및 물리
│   │   ├── UIControls.tsx        # 게임 내 UI (점수, 발사체, 초기화 버튼 등)
│   │   ├── LevelEditor.tsx       # 레벨 생성 및 편집 UI
│   │   ├── LibraryModal.tsx      # 커스텀 레벨 라이브러리 UI
│   │   ├── PowerGauge.tsx        # 발사 파워 게이지 UI
│   │   └── ProjectileSelector.tsx# 발사체 선택 UI
│   ├── lib/
│   │   └── geminiService.ts      # Gemini API 연동 로직
│   ├── types.ts                  # TypeScript 타입 정의
│   ├── constants.ts              # 게임 상수 (물리 값, 점수, 발사체 설정 등)
│   └── levels.ts                 # 기본 제공 레벨 설정
├── metadata.json                 # 애플리케이션 메타데이터
├── README.md                     # 프로젝트 설명 파일
└── tailwind.config.js            # (만약 있다면) Tailwind CSS 설정
```

## 설정 및 실행

이 프로젝트는 별도의 빌드 과정 없이 `index.html` 파일을 웹 브라우저에서 직접 열어 실행할 수 있도록 구성되어 있습니다.

1.  프로젝트 파일을 다운로드하거나 클론합니다.
2.  웹 브라우저에서 `public/index.html` (또는 프로젝트 루트의 `index.html` - 구조에 따라 다름) 파일을 엽니다.

### API 키 설정 (Gemini API)

AI 레벨 생성 기능을 사용하려면 Gemini API 키가 필요합니다. API 키는 다음 두 가지 방법 중 하나로 설정할 수 있습니다:

1.  **환경 변수 (권장):**
    *   프로젝트 실행 환경에서 `API_KEY`라는 이름의 환경 변수를 설정합니다. 이 방법은 코드를 수정하지 않고 키를 안전하게 관리할 수 있는 방법입니다.
    *   예: `API_KEY="YOUR_GEMINI_API_KEY"`

2.  **레벨 에디터 내 입력:**
    *   게임 내 레벨 에디터 UI 하단에 있는 "Gemini API 키" 입력 필드에 API 키를 직접 입력하고 "키 저장" 버튼을 누릅니다.
    *   이 방법으로 저장된 키는 브라우저의 `localStorage`에 저장됩니다. `localStorage`는 보안에 민감한 정보를 저장하기에 가장 안전한 장소는 아니므로, 개발 또는 개인적인 테스트 용도로만 사용하는 것이 좋습니다.

API 키가 올바르게 설정되면 레벨 에디터 내 "Gemini API 상태"가 "활성"으로 표시되며, AI 레벨 생성 기능을 사용할 수 있게 됩니다.

## 게임 방법

*   **목표:** 각 레벨에서 빛나는 황금 블록을 성공적으로 무너뜨리는 것입니다.
*   **조작법:**
    *   **발사체 발사:** 게임 화면(캔버스 영역)을 마우스 왼쪽 버튼으로 클릭하고 누르고 있으면 파워 게이지가 차오릅니다. 원하는 파워에서 마우스 버튼을 놓으면 현재 선택된 발사체가 발사됩니다.
    *   **카메라 조작 (게임 화면):**
        *   **확대/축소:** 마우스 휠 스크롤
        *   **회전:** 마우스 휠 버튼(가운데 버튼) 클릭 후 드래그
    *   **발사체 선택:** 화면 상단의 UI 컨트롤에서 원하는 발사체 아이콘을 클릭하여 선택합니다. 각 발사체는 고유한 특성과 남은 수량을 가집니다.
    *   **게임 초기화:** "초기화" 버튼을 누르면 게임이 첫 번째 레벨부터 다시 시작됩니다.

## 레벨 에디터 사용법

1.  **에디터 열기:** 메인 화면 또는 게임 중 화면 우측 상단의 "에디터 열기" 버튼을 클릭합니다.
2.  **인터페이스:**
    *   **3D 캔버스:** 레벨 구조를 시각적으로 확인하고 블록을 배치하는 공간입니다.
        *   **블록 놓기:** 마우스 왼쪽 클릭
        *   **블록 제거:** 마우스 오른쪽 클릭 (제거할 블록 위에 커서)
        *   **카메라 조작:** 마우스 휠 (확대/축소), 마우스 휠 클릭 + 드래그 (회전)
    *   **컨트롤 패널 (하단):**
        *   **레벨 이름:** 생성할 레벨의 이름을 입력합니다.
        *   **발사체:** 해당 레벨에서 사용할 초기 발사체 수를 설정합니다.
        *   **색상 선택:** 배치할 블록의 색상을 선택합니다. "골드 (황금)" 색상은 황금 블록을 지정하는 데 사용됩니다.
        *   **모양 선택:** 배치할 블록의 모양(큐브, 원기둥, 구 등)을 선택합니다.
        *   **가져오기/내보내기:** 현재 에디터의 레벨을 JSON 파일로 내보내거나, 로컬 파일에서 가져올 수 있습니다.
        *   **저장 (앱에):** 현재 에디터에서 작업 중인 레벨을 앱 내 커스텀 레벨 라이브러리에 저장합니다 (새 레벨로 저장하거나 기존 커스텀 레벨 업데이트).
        *   **닫기:** 에디터를 종료하고 이전 화면으로 돌아갑니다.
3.  **황금 블록 지정:** 컨트롤 패널에서 "골드 (황금)" 색상을 선택한 후 3D 캔버스에 블록을 배치하면 해당 블록이 황금 블록으로 지정됩니다. 레벨에는 **반드시 하나**의 황금 블록이 있어야 합니다.
4.  **AI 레벨 생성:**
    *   (Gemini API 키가 설정되어 있어야 합니다.)
    *   "AI 생성 프롬프트" 입력 필드에 원하는 레벨의 테마나 구조를 설명하는 텍스트를 입력합니다. (예: "높고 불안정한 탑과 주변의 작은 장애물들", "미로처럼 복잡하지만 안정적인 구조")
    *   "AI 레벨 생성" 버튼을 클릭합니다. 잠시 후 AI가 생성한 레벨 구조가 에디터에 로드됩니다.
    *   **주의:** AI가 생성한 레벨은 항상 완벽하게 안정적이거나 의도한 대로 나오지 않을 수 있습니다. 생성 후 직접 수정하거나, 프롬프트를 바꿔 다시 시도해 보세요. AI는 설정된 블록 수 제한(최대 25개) 및 안정성 규칙을 따르려고 하지만, 때때로 조정이 필요할 수 있습니다.

## 레벨 라이브러리 사용법

1.  **라이브러리 열기:** 메인 화면 또는 게임 중 화면 우측 상단의 "라이브러리" 버튼을 클릭합니다.
2.  **기능:**
    *   **목록 보기:** 저장된 커스텀 레벨 목록을 보여줍니다. (AI 생성, 에디터 제작, 가져온 레벨 등 출처 표시)
    *   **검색:** 레벨 이름으로 원하는 커스텀 레벨을 검색할 수 있습니다.
    *   **플레이:** 목록에서 레벨 옆의 "플레이" 버튼을 클릭하면 해당 커스텀 레벨을 즉시 시작합니다.
    *   **에디터로 불러오기:** 레벨 이름을 클릭하면 해당 레벨을 레벨 에디터로 불러와 수정할 수 있습니다.
    *   **삭제:** "삭제" 버튼으로 원치 않는 커스텀 레벨을 라이브러리에서 제거합니다.
    *   **라이브러리 가져오기/내보내기:**
        *   **가져오기:** 로컬의 `domino_castle_library.json` 형식의 파일을 선택하여 전체 커스텀 레벨 라이브러리를 한 번에 가져올 수 있습니다. (중복 ID/이름 레벨은 제외될 수 있음)
        *   **내보내기:** 현재 앱에 저장된 모든 커스텀 레벨을 `domino_castle_library.json` 파일로 내보냅니다.

## 향후 개발 방향

*   **추가 발사체 종류:** 더 다양하고 특수한 능력을 가진 발사체 추가.
*   **블록 종류 다양화:** 특수 효과를 가진 블록 (예: 폭발 블록, 자석 블록 등) 추가.
*   **레벨 에디터 기능 강화:** 회전 도구, 다중 선택, 대칭 배치 등 고급 편집 기능.
*   **AI 프롬프트 엔지니어링 개선:** 더 정교하고 창의적인 레벨을 생성할 수 있도록 Gemini API 프롬프트 최적화.
*   **게임 내 튜토리얼 및 도움말 강화.**
*   **사운드 이펙트 및 배경음악 추가.**
*   **다국어 지원 확대.**

## 현지화

현재 게임의 사용자 인터페이스는 주로 한국어로 제공됩니다.

---

이 README가 "캐슬 브레이커" 프로젝트를 이해하고 사용하는 데 도움이 되기를 바랍니다!
